@page "/Categories/{categoryCode}/{discussionCode}"
@using System.Security.Claims
@using Zodpovedne.Contracts.Enums
@inject Zodpovedne.Logging.Services.Translator Translator
@model DiscussionModel
@{
    ViewData["Title"] = Model.Discussion?.Title ?? "Diskuze";
    /* Detail diskuse */

    //Pokud je jakýkoliv text v ErrorMessage, tak se zobrazí a zbytek stránky se nevykreslí
    if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-warning">
            <h4>@Model.ErrorMessage</h4>
        </div>
        return;
    }
    //Pokud je jakýkoliv text v StatusMessage, tak se zobrazí úplně nahoře a pokračuje se ve vykreslování stránky
    if (!string.IsNullOrEmpty(Model.StatusMessage))
    {
        <div class="alert alert-info">
            <h4>@Model.StatusMessage</h4>
        </div>
    }
}

<div class="container">
    <div class="row mb-4">
        <div class="col">
            <div class="detail-diskuse-title-wrapper">
                <h1 class="text-center detail-diskuse-title">
                    <a href="/Categories/@Model.CategoryCode" class="text-decoration-none">@Model.CategoryName</a>
                </h1>
            </div>
            @if (Model.Discussion != null)
            {
                <div class="card mt-2 shadow text-editor-wrapper">
                    <div class="card-header text-editor-head">
                        @* Nadpis diskuze - editovatelný pro oprávněné uživatele *@
                        @if (Model.CanEditDiscussion)
                        {
                            <div class="editable-title">
                                <h1 class="h3 text-editor-title" id="discussion-title-display">@Model.Discussion.Title</h1>
                                <input type="text" class="form-control d-none mb-1" id="discussion-title-edit" value="@Model.Discussion.Title" maxlength="70" />
                            </div>
                        }
                        else
                        {
                            <h1 class="h3 mb-0 text-editor-title">@Model.Discussion.Title</h1>
                        }

                        @* Přidejte toto do sekce s detaily diskuze, např. do card-header *@
                        @if (Model.IsAdmin && Model.Discussion != null)
                        {
                            <div class="mt-3">
                                <form method="post" asp-page-handler="ChangeCategory" onsubmit="return confirmCategoryChange()">
                                    <div class="input-group">
                                        <select id="categorySelect" name="newCategoryId" class="form-select mb-3">
                                            <option value="">-- Vyberte kategorii --</option>
                                            @foreach (var category in Model.AllCategories)
                                            {
                                                bool isSelected = category.Id == Model.Discussion.CategoryId;
                                                <option value="@category.Id" selected="@isSelected">
                                                    @category.Name
                                                </option>
                                            }
                                        </select>
                                        <button type="submit" class="btn btn-outline-primary-invert mb-3">
                                            Změnit kategorii
                                        </button>
                                    </div>
                                </form>
                            </div>
                        }

                        @* Metadata diskuze *@
                        <div class="text-muted small ">
                            <span title="Autor" >
                                <i class="bi bi-person"></i>
                                <span>
                                    <a class="texty-ikon-diskuse" asp-page="/Account/Profile" asp-route-nickname="@Model.Discussion!.AuthorNickname">@Model.Discussion!.AuthorNickname</a>
                                </span>
                            </span>
                            <span>&nbsp;</span>
                            <span title="Datum vytvoření">
                                <i class="bi bi-calendar-plus"></i><span>&nbsp;</span><span class="texty-ikon-diskuse">@Model.Discussion.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy")</span>
                            </span>
                            <span class="texty-ikon-diskuse">&nbsp;|&nbsp;</span>
                            <span title="Datum aktualizace"> <!-- Tady je potřeba udělat podmínku pro zobrazení hodnoty ohledně upraveno -->
                                <i class="bi bi-pencil"></i> <span class="texty-ikon-diskuse" id="discussionUpdatedAtValue">@Model.Discussion.UpdatedAt.ToLocalTime().ToString("dd.MM.yyyy")</span>
                            </span>

                            @if (Model.Discussion.Type == DiscussionType.Hidden)
                            {
                                //<span class="badge bg-warning ms-2">Tvá diskuze je skrytá</span>
                            }
                        </div>
                    </div>

                    @* Obsah diskuze - editovatelný pro oprávněné uživatele *@
                    <div class="card-body">
                        @if (Model.CanEditDiscussion)
                        {
                            <div class="editable-content">
                                <div id="discussion-content-display" class="discussion-content">@Html.Raw(Model.Discussion.Content)</div>
                                <div id="toolbar-container" class="d-none"></div>
                                <div id="editor-container" class="d-none">@Html.Raw(Model.Discussion.Content)</div>
                            </div>
                        }
                        else
                        {
                            <div class="discussion-content">@Html.Raw(Model.Discussion.Content)</div>
                        }
                    </div>

                    @* Panel s tlačítky pro like, editaci a změnu viditelnosti *@
                    <div class="card-footer text-editor-footer d-flex align-items-center">
                        <div class="d-flex gap-1 detail-diskuse-dolni-btn-wrapper">
                            @* Tlačítko Like *@
                            @if (Model.CanLikeDiscussion)
                            {
                                <button class="btn like-btn-footer @Model.GetLikeButtonClass(Model.Discussion.Likes.CanUserLike)"
                                onclick="likeDiscussion(@Model.Discussion.Id)"
                                @(!Model.Discussion.Likes.CanUserLike ? "disabled" : "")>
                                    @* Pokud okud uživatle může likovat vloží se nevyplněné srdce, pokud nemůže likovat srdce bude vyplněné *@
                                    @if (Model.Discussion.Likes.CanUserLike)
                                    {
                                        <text><i title="Přidat srdce" class="bi bi-heart"></i></text>
                                    }
                                    else{
                                        <text><i title="Počet srdcí od uživatelů" class="bi bi-heart-fill"></i></text>
                                    }
                                    <span id="discussion-likes-count">@Model.Discussion.Likes.LikeCount</span>
                                </button>
                                <span title="Počet zobrazení" class="d-flex align-items-center pocetZobrazeni">
                                    <i class="bi bi-eye"></i> @Model.Discussion.ViewCount
                                </span>
                            }
                            else
                            {
                                <span class="text-muted like-btn-disable">
                                    <i title="Počet srdcí od uživatelů" class="bi bi-heart-fill"></i>
                                    @Model.Discussion.Likes.LikeCount
                                </span>
                                <span title="Počet zobrazení" class="d-flex align-items-center pocetZobrazeni">
                                    <i class="bi bi-eye"></i> @Model.Discussion.ViewCount
                                </span>
                            }
                            @if (Model.Discussion.Type == DiscussionType.Top)
                            {
                                <span class="top-star" title="Top hodnocená diskuse">@*TOP*@
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">

                                        <path d="M12,2 L15.09,8.26 L22,9.27 L17,14.14 L18.18,21.02 L12,17.77 L5.82,21.02 L7,14.14 L2,9.27 L8.91,8.26 Z"
                                        fill="var( --light-primary-color)"
                                        stroke="var(--primary-color)"
                                        stroke-width="0.5" />

                                        <text x="12" y="14"
                                        font-family="Arial, sans-serif"
                                        font-weight="bold"
                                        font-size="4.5"
                                        text-anchor="middle"
                                         fill="var(--primary-color)">TOP</text>
                                    </svg>
                                </span>
                            }
                            @* Tlačítko pro změnu viditelnosti (pouze pro adminy) *@
                            @if (Model.IsAdmin)
                            {
                                <button class="btn @(Model.Discussion.Type == DiscussionType.Hidden ? "btn-outline-primary prepniVlastnostBtn" : "btn-outline-primary prepniVlastnostBtn")"
                                onclick="toggleDiscussionVisibility(@Model.Discussion.Id)">
                                    <i class="bi bi-eye@(Model.Discussion.Type == DiscussionType.Hidden ? "" : "-slash")"></i>

                                </button>
                            }



                            @* Tlačítko pro přepínání typu diskuze mezi Top a Normal (pouze pro adminy) *@
                            @if (Model.IsAdmin && (Model.Discussion.Type == DiscussionType.Normal || Model.Discussion.Type == DiscussionType.Top))
                            {
                                <button class="btn @(Model.Discussion.Type == DiscussionType.Top ? "btn-outline-primary prepniVlastnostBtn" : "btn-outline-primary prepniVlastnostBtn")"
                                        onclick="toggleTopStatus(@Model.Discussion.Id)">
                                    @if (Model.Discussion.Type == DiscussionType.Top)
                                    {
                                        <text>
                                            <span>
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                                                    <path d="M12,2 L15.09,8.26 L22,9.27 L17,14.14 L18.18,21.02 L12,17.77 L5.82,21.02 L7,14.14 L2,9.27 L8.91,8.26 Z"
                                                          fill="#FFB5B5"
                                                          stroke="#e06f70"
                                                          stroke-width="0.5" />

                                                    <text x="12" y="14"
                                                          font-family="Arial, sans-serif"
                                                          font-weight="bold"
                                                          font-size="4.5"
                                                          text-anchor="middle"
                                                          fill="#d15657">TOP</text>

                                                    <line x1="2" y1="2" x2="22" y2="22"
                                                          stroke="#e06f70"
                                                          stroke-width="1"
                                                          stroke-linecap="round" />
                                                </svg>
                                            </span>
                                        </text>
                                    }
                                    else
                                    {
                                        <text>
                                            <span class="top-star">
                                                @*TOP*@
                                                <path d="M12,2 L15.09,8.26 L22,9.27 L17,14.14 L18.18,21.02 L12,17.77 L5.82,21.02 L7,14.14 L2,9.27 L8.91,8.26 Z"
                                                      fill="var( --light-primary-color)"
                                                      stroke="var(--primary-color)"
                                                      stroke-width="0.5" />

                                                <text x="12" y="14"
                                                      font-family="Arial, sans-serif"
                                                      font-weight="bold"
                                                      font-size="4.5"
                                                      text-anchor="middle"
                                                      fill="var(--primary-color)">TOP</text>
                                            </span>
                                        </text>
                                    }
                                </button>
                            }

                          <button type="button" id="emoji-btn-discussion">&#128512;</button>

                        </div>

                        @* Tlačítka pro editaci *@
                        @if (Model.CanEditDiscussion)
                        {
                            <div class="btn-group d-flex gap-1">
                                @* Tlačítko pro přepínání typu diskuze mezi Private a Normal (pouze pro autory diskuze a adminy) *@
                                @if ((Model.Discussion.Type == DiscussionType.Normal || Model.Discussion.Type == DiscussionType.Private))
                                {
                                    <button style="border-radius: 5px;" class="btn btn-outline-primary @(Model.Discussion.Type == DiscussionType.Private ? "btn-outline-primary prepniVlastnostBtn" : "btn-outline-primary prepniVlastnostBtn")"
                                            onclick="togglePrivateStatus(@Model.Discussion.Id)">
                                        @if (Model.Discussion.Type == DiscussionType.Normal)
                                        {
                                            <text>
                                                <span title="Nastavit režim jen pro přátele. Diskusi uvidí pouze vaši přátelé.">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <!-- Kulaté pozadí -->
                                                        <circle cx="12" cy="12" r="12" fill="var(--light-primary-color-ultra-light)" />
                                                        <!-- Tělo zámku -->
                                                        <rect x="6" y="10" width="12" height="10" rx="2" fill="var(--light-primary-color-ultra-light)" stroke="var(--primary-color, #4A90E2)" stroke-width="1.5" />

                                                        <!-- Horní část zámku -->
                                                        <path d="M9,10 L9,7 C9,5.34315 10.3431,4 12,4 C13.6569,4 15,5.34315 15,7 L15,10" fill="none" stroke="var(--primary-color, #4A90E2)" stroke-width="1.5" stroke-linecap="round" />

                                                        <!-- Klíčová dírka -->
                                                        <circle cx="12" cy="14" r="1.5" fill="var(--primary-color)" />
                                                        <rect x="11.25" y="14" width="1.5" height="3" fill="var(--primary-color)" />
                                                    </svg>
                                                    <span style="font-size: 12px;">Jen pro přátele</span>
                                                </span>
                                            </text>
                                        }
                                        else
                                        {
                                            <text>
                                                <span title="Zrušit režim jen pro přátele. Diskuse bude veřejně dostupná.">
                                                    @*Private*@
                                                    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <!-- Kulaté pozadí -->
                                                        <circle cx="12" cy="12" r="12" fill="var(--light-primary-color-ultra-light)" />
                                                        <!-- Tělo zámku -->
                                                        <rect x="6" y="10" width="12" height="10" rx="2" fill="var(--light-primary-color-ultra-light, #e6f0fa)" stroke="var(--primary-color, #4A90E2)" stroke-width="1.5" />

                                                        <!-- Horní část zámku -->
                                                        <path d="M9,10 L9,7 C9,5.34315 10.3431,4 12,4 C13.6569,4 15,5.34315 15,7 L15,10" fill="none" stroke="var(--primary-color, #4A90E2)" stroke-width="1.5" stroke-linecap="round" />

                                                        <!-- Klíčová dírka -->
                                                        <circle cx="12" cy="14" r="1.5" fill="var(--primary-color, #4A90E2)" />
                                                        <rect x="11.25" y="14" width="1.5" height="3" fill="var(--primary-color, #4A90E2)" />

                                                        <!-- Přeškrtnutí -->
                                                        <line x1="4" y1="4" x2="20" y2="20" stroke="var(--primary-color, #4A90E2)" stroke-width="2" stroke-linecap="round" />
                                                    </svg>
                                                    <span style="font-size: 12px;">Veřejné</span>

                                                </span>
                                            </text>
                                        }
                                    </button>
                                }
                                <button id="edit-discussion-btn" class="btn btn-primary" onclick="toggleDiscussionEdit(true)">
                                    <i title="Upravit diskusi" class="bi bi-pencil"></i>
                                </button>
                                <button id="save-discussion-btn" style="border-radius:5px;" class="btn btn-outline-primary d-none" onclick="saveDiscussionChanges(@Model.Discussion.Id, @((int)Model.Discussion.Type), event)">
                                    <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <!-- Kulaté pozadí -->
                                        <circle cx="10" cy="10" r="10" fill="#99cc33" />

                                        <!-- Ikona fajfky -->
                                        <path d="M6,10.2 L8.5,12.7 L14,7.2"
                                              fill="none"
                                              stroke="#006633"
                                              stroke-width="2"
                                              stroke-linecap="round"
                                              stroke-linejoin="round" />
                                    </svg> Uložit
                                </button>
                                <button id="cancel-discussion-btn" style="border-radius:5px;" class="btn btn-outline-primary d-none" onclick="handleCancelEditDiscussionClick()">
                                    <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <!-- Kulaté pozadí -->
                                        <circle cx="10" cy="10" r="10" fill="#dc3545" />

                                        <!-- Ikona křížku -->
                                        <path d="M7,7 L13,13 M13,7 L7,13"
                                              fill="none"
                                              stroke="white"
                                              stroke-width="2"
                                              stroke-linecap="round"
                                              stroke-linejoin="round" />
                                    </svg> Zrušit
                                </button>
                                <form method="post" asp-page-handler="DeleteDiscussion" class="d-inline">
                                    <button type="submit" class="btn btn-danger"
                                            onclick="return confirm('Opravdu chcete smazat tuto diskuzi včetně všech komentářů?')">
                                        <i title="Smazat diskusi" class="bi bi-trash"></i>@* Smazat *@
                                    </button>
                                </form>
                            </div>
                        }
                    </div>
                    <div id="emoji-list-discussion">
                        <!-- Srdce a like emoji -->
                        <span class="emoji">&#x2764;&#xFE0F;</span>     <!-- červené srdce -->
                        <span class="emoji">&#128077;</span>    <!-- palec nahoru -->
                        <span class="emoji">&#128079;</span>    <!-- tleskání -->
                        <span class="emoji">&#128076;</span>    <!-- OK symbol -->
                        <span class="emoji">&#128591;</span>    <!-- sepjaté ruce -->
                        <span class="emoji">&#128075;</span>    <!-- mávající ruka -->
                        <span class="emoji">&#128170;</span>    <!-- biceps -->
                        <span class="emoji">&#128400;</span>    <!-- OK symbol ruka -->
                        <!-- Standardní smajlíky vyjadřující emoce -->
                        <span class="emoji">&#128512;</span>    <!-- široký úsměv -->
                        <span class="emoji">&#128513;</span>    <!-- úsměv s velkýma očima -->
                        <span class="emoji">&#128514;</span>    <!-- smích se slzami -->
                        <span class="emoji">&#128515;</span>    <!-- úsměv s úsměvnýma očima -->
                        <span class="emoji">&#128516;</span>    <!-- úsměv s přimhouřenýma očima -->
                        <span class="emoji">&#128517;</span>    <!-- úsměv s potem -->
                        <span class="emoji">&#128518;</span>    <!-- úsměv s šilhavýma očima -->
                        <span class="emoji">&#128519;</span>    <!-- anděl -->
                        <span class="emoji">&#128520;</span>    <!-- ďáblík -->
                        <span class="emoji">&#128521;</span>    <!-- mrkající -->
                        <span class="emoji">&#128522;</span>    <!-- spokojený -->
                        <span class="emoji">&#128523;</span>    <!-- olizující se -->
                        <span class="emoji">&#128524;</span>    <!-- bez výrazu -->
                        <span class="emoji">&#128525;</span>    <!-- zamilovaný -->
                        <span class="emoji">&#128526;</span>    <!-- chladný s brýlemi -->
                        <span class="emoji">&#128527;</span>    <!-- samolibý -->
                        <span class="emoji">&#128528;</span>    <!-- neutrální -->
                        <span class="emoji">&#128529;</span>    <!-- bezvýrazný -->
                        <span class="emoji">&#128530;</span>    <!-- zklamaný -->
                        <span class="emoji">&#128531;</span>    <!-- studený pot -->
                        <span class="emoji">&#128532;</span>    <!-- smutný -->
                        <span class="emoji">&#128533;</span>    <!-- zmatený -->
                        <span class="emoji">&#128534;</span>    <!-- sklíčený -->
                        <span class="emoji">&#128535;</span>    <!-- polibek -->
                        <span class="emoji">&#128536;</span>    <!-- polibek s očima -->
                        <span class="emoji">&#128537;</span>    <!-- milující -->
                        <span class="emoji">&#128538;</span>    <!-- polibek s úsměvem -->
                        <span class="emoji">&#128539;</span>    <!-- vypláznutý jazyk -->
                        <span class="emoji">&#128540;</span>    <!-- vypláznutý jazyk a mrkání -->
                        <span class="emoji">&#128541;</span>    <!-- vypláznutý jazyk a šilhání -->
                        <span class="emoji">&#128542;</span>    <!-- zklamaný -->
                        <span class="emoji">&#128543;</span>    <!-- uražený -->
                        <span class="emoji">&#128544;</span>    <!-- vzteklý -->
                        <span class="emoji">&#128545;</span>    <!-- rozzlobený -->
                        <span class="emoji">&#128546;</span>    <!-- plačící -->
                        <span class="emoji">&#128547;</span>    <!-- trpící -->
                        <span class="emoji">&#128548;</span>    <!-- zamračený se zuby -->
                        <span class="emoji">&#128549;</span>    <!-- úzkostný s potem -->
                        <span class="emoji">&#128550;</span>    <!-- překvapený -->
                        <span class="emoji">&#128551;</span>    <!-- zklamaný ale ulevený -->
                        <span class="emoji">&#128552;</span>    <!-- vyděšený -->
                        <span class="emoji">&#128553;</span>    <!-- unavený -->
                        <span class="emoji">&#128554;</span>    <!-- ospalý -->
                        <span class="emoji">&#128555;</span>    <!-- unavený -->
                        <span class="emoji">&#128556;</span>    <!-- grimasa -->
                        <span class="emoji">&#128557;</span>    <!-- hlasitě plačící -->
                        <span class="emoji">&#128558;</span>    <!-- překvapený s otevřenými ústy -->
                        <span class="emoji">&#128559;</span>    <!-- překvapený -->
                        <span class="emoji">&#128560;</span>    <!-- vyděšený -->
                        <span class="emoji">&#128561;</span>    <!-- křičící -->
                        <span class="emoji">&#129326;</span>    <!-- nevolnost -->
                        <span class="emoji">&#129327;</span>    <!-- kýchnutí -->
                        <span class="emoji">&#129318;</span>    <!-- obracející oči -->
                        <span class="emoji">&#129335;</span>    <!-- pokrčení rameny -->
                        <span class="emoji">&#x1F648;</span>    <!-- opice -->
                        <span class="emoji">&#128580;</span>    <!-- nedůvěřivý -->
                        <span class="emoji">&#129296;</span>    <!-- mrzoutský -->
                        <span class="emoji">&#129301;</span>    <!-- po úrazu -->
                        <span class="emoji">&#x1F321;</span>    <!-- teploměr -->
                        <span class="emoji">&#129314;</span>    <!-- na zvracení -->
                        <span class="emoji">&#128564;</span>    <!-- spící -->
                        <span class="emoji">&#128567;</span>    <!-- s rouškou -->
                        <span class="emoji">&#128562;</span>    <!-- šokovaný -->
                        <!-- Oslavné a sváteční emoji -->
                        <span class="emoji">&#127881;</span>    <!-- party popper -->
                        <span class="emoji">&#x2728;</span>    <!-- hvězdicky -->
                        <span class="emoji">&#128144;</span>    <!-- kvetina -->
                        <span class="emoji">&#127942;</span>    <!-- trofej -->
                        <span class="emoji">&#127874;</span>    <!-- narozeninový dort -->
                        <span class="emoji">&#x1F381;</span>    <!-- dárek -->
                        <span class="emoji">&#127872;</span>    <!-- dárek -->
                        <span class="emoji">&#127882;</span>    <!-- konfety -->
                        <span class="emoji">&#127880;</span>    <!-- hvězda -->
                        <!-- Jídlo a pití -->
                        <span class="emoji">&#127849;</span>    <!-- donut -->
                        <span class="emoji">&#127846;</span>    <!-- zmrzlina -->
                        <span class="emoji">&#127863;</span>    <!-- víno -->
                        <span class="emoji">&#127866;</span>    <!-- pivo -->
                        <span class="emoji">&#129365;</span>    <!-- brambora -->
                        <span class="emoji">&#129379;</span>    <!-- muffin -->
                        <span class="emoji">&#127814;</span>    <!-- hruška -->
                        <span class="emoji">&#129382;</span>    <!-- želé -->
                        <span class="emoji">&#127812;</span>    <!-- houby -->
                        <span class="emoji">&#127836;</span>    <!-- nudle -->
                        <span class="emoji">&#127828;</span>    <!-- hamburger -->
                        <span class="emoji">&#127839;</span>    <!-- hranolky -->
                        <span class="emoji">&#127852;</span>    <!-- čokoláda -->
                        <span class="emoji">&#127829;</span>    <!-- pizza -->
                        <span class="emoji">&#129366;</span>    <!-- chleba -->
                        <span class="emoji">&#129472;</span>    <!-- čaj -->
                        <span class="emoji">&#127851;</span>    <!-- lízátko -->
                        <span class="emoji">&#129375;</span>    <!-- vajíčko -->
                        <span class="emoji">&#129360;</span>    <!-- palačinka -->
                        <span class="emoji">&#129367;</span>    <!-- čajová konvice -->
                        <span class="emoji">&#127855;</span>    <!-- koktejl -->
                        <!-- Zvířata -->
                        <span class="emoji">&#128054;</span>    <!-- pes -->
                        <span class="emoji">&#128049;</span>    <!-- kočka -->
                        <span class="emoji">&#128008;</span>    <!-- kočka -->
                        <span class="emoji">&#128021;</span>    <!-- prasátko -->
                        <span class="emoji">&#128039;</span>    <!-- kuře -->
                        <span class="emoji">&#128038;</span>    <!-- pták -->
                        <span class="emoji">&#128044;</span>    <!-- kuře -->
                        <span class="emoji">&#128023;</span>    <!-- ovce -->
                        <span class="emoji">&#128040;</span>    <!-- koala -->
                        <span class="emoji">&#129409;</span>    <!-- lama -->
                        <span class="emoji">&#129418;</span>    <!-- liška -->
                        <!-- Květiny a příroda -->
                        <span class="emoji">&#127808;</span>    <!-- čtyřlístek -->
                        <span class="emoji">&#x1F335;</span>    <!-- kaktus -->
                        <span class="emoji">&#x1F334;</span>    <!-- palma -->
                        <span class="emoji">&#127794;</span>    <!-- jehličnatý strom -->
                        <span class="emoji">&#127793;</span>    <!-- listnatý strom -->
                        <span class="emoji">&#127807;</span>    <!-- tulipán -->
                        <span class="emoji">&#127799;</span>    <!-- růže -->
                        <span class="emoji">&#127804;</span>    <!-- slunečnice -->
                        <span class="emoji">&#127802;</span>    <!-- zvadlá květina -->
                        <span class="emoji">&#127809;</span>    <!-- javor -->
                        <span class="emoji">&#127810;</span>    <!-- listí -->
                        <!-- Počasí a vesmír -->
                        <span class="emoji">&#9728;</span>      <!-- slunce -->
                        <span class="emoji">&#11088;</span>     <!-- hvězda -->
                        <span class="emoji">&#127771;</span>    <!-- měsíc -->
                        <span class="emoji">&#9889;</span>      <!-- blesk -->
                        <span class="emoji">&#9729;</span>      <!-- mrak -->
                        <span class="emoji">&#127785;</span>    <!-- tornádo -->
                        <span class="emoji">&#127782;</span>    <!-- duha -->
                        <span class="emoji">&#10052;</span>     <!-- sněhová vločka -->
                        <span class="emoji">&#x2603;</span>     <!-- sněhulák -->
                        <span class="emoji">&#9748;</span>      <!-- deštník -->
                        <!-- Doprava a budovy -->
                        <span class="emoji">&#128663;</span>    <!-- auto -->
                        <span class="emoji">&#9992;</span>      <!-- letadlo -->
                        <span class="emoji">&#x1F3D6;</span>      <!-- letadlo -->
                        <span class="emoji">&#128674;</span>    <!-- loď -->
                        <span class="emoji">&#128690;</span>    <!-- kolo -->
                        <span class="emoji">&#128657;</span>    <!-- ambulance -->
                        <span class="emoji">&#x1F514;</span>    <!-- zvonek -->
                        <span class="emoji">&#9888;</span>      <!-- varování -->
                        <span class="emoji">&#128680;</span>    <!-- policie -->
                        <span class="emoji">&#128643;</span>    <!-- metro -->
                        <span class="emoji">&#128642;</span>    <!-- lokomotiva -->
                        <span class="emoji">&#127974;</span>    <!-- budova -->
                        <span class="emoji">&#127968;</span>    <!-- dům -->
                        <span class="emoji">&#127981;</span>    <!-- továrna -->
                        <span class="emoji">&#127970;</span>    <!-- vysoká budova -->
                        <!-- Různé -->
                        <span class="emoji">&#128176;</span>    <!-- peníze s křídly -->
                        <span class="emoji">&#128181;</span>    <!-- měna -->
                        <span class="emoji">&#x1F4D6;</span>    <!-- kniha -->
                        <span class="emoji">&#x1F4DA;</span>    <!-- knihy -->
                        <span class="emoji">&#128197;</span>    <!-- kalendář -->
                        <span class="emoji">&#9989;</span>      <!-- zelená značka zaškrtnutí -->
                        <span class="emoji">&#10060;</span>     <!-- červený křížek -->
                        <span class="emoji">&#128066;</span>    <!-- ucho -->
                        <span class="emoji">&#128064;</span>    <!-- oči -->
                        <span class="emoji">&#128067;</span>    <!-- nos -->
                        <span class="emoji">&#127936;</span>    <!-- basketbal -->
                        <span class="emoji">&#127938;</span>    <!-- lyžař -->
                        <span class="emoji">&#9917;</span>      <!-- fotbalový míč -->
                        <span class="emoji">&#x1F945;</span>    <!-- brána -->
                        <span class="emoji">&#127939;</span>    <!-- běžec -->
                        <span class="emoji">&#128240;</span>    <!-- noviny -->
                        <span class="emoji">&#128241;</span>    <!-- telefon -->
                        <span class="emoji">&#x1F4FA;</span>    <!-- tv -->
                        <span class="emoji">&#128269;</span>    <!-- lupa -->
                        <span class="emoji">&#128373;</span>    <!-- detektiv -->
                    </div>
                </div>

                <!-- Sekce pro hlasování - zobrazí se, jen pokud diskuze má hlasování -->
                @if (Model.Discussion.VoteType != VoteType.None)
                {
                    <div class="card mt-4 shadow" id="voting-section">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h3 class="mb-0">Hlasování</h3>
                            @if (Model.Discussion.VoteType == VoteType.Closed)
                            {
                                <span class="badge bg-secondary">Hlasování uzavřeno</span>
                            }
                            else if (Model.Discussion.VoteType == VoteType.Hidden)
                            {
                                <span class="badge bg-warning">Hlasování skryto</span>
                            }
                        </div>
                        <div class="card-body">
                            <!-- Inicializace načítání hlasování -->
                            <div id="voting-loading" class="text-center py-3">
                                <div class="spinner-border spinner-border-sm" role="status">
                                    <span class="visually-hidden">Načítání hlasování...</span>
                                </div>
                                <span class="ms-2">Načítání hlasování...</span>
                            </div>

                            <!-- Kontejner pro otázky hlasování, naplní se JavaScriptem -->
                            <div id="voting-questions-container" class="d-none">
                                <!-- Sem se dynamicky přidají otázky hlasování -->
                            </div>

                            <!-- Tlačítko pro odeslání hlasů (viditelné jen když lze hlasovat) -->
                            @if (Model.Discussion.VoteType == VoteType.Visible && Model.IsUserLoggedIn)
                            {
                                <div class="mt-3 text-center">
                                    <button id="submit-votes-btn" class="btn btn-primary">
                                        Hlasovat
                                    </button>
                                </div>
                            }
                        </div>
                    </div>
                }

                @functions {
                public string GetVotingStatusText(VoteType voteType)
                {
                    return voteType switch
                    {
                        VoteType.Visible => "V tomto hlasování můžete vyjádřit svůj názor ke každé otázce. Zvolte Ano, Ne, nebo Nehlasuji.",
                        VoteType.Closed => "Hlasování je uzavřeno. Můžete vidět výsledky, ale již nelze hlasovat.",
                        VoteType.Hidden => "Toto hlasování je nyní skryté. Vidíte ho, protože jste autor diskuze.",
                        _ => "Neplatný stav hlasování"
                    };
                }
            }

            <!-- Sekce pro editaci/založení hlasování -->
            @if (Model.CanEditDiscussion && Model.Discussion != null)
            {
                <div class="mt-3 mb-4">
                    @if (Model.Discussion.VoteType == VoteType.None)
                    {
                        <!-- Tlačítko pro vytvoření nového hlasování -->
                        <button type="button" class="btn btn-outline-primary" id="create-voting-btn" data-bs-toggle="modal" data-bs-target="#voting-modal">
                            <i class="bi bi-bar-chart-fill"></i> Vytvořit hlasování
                        </button>
                    }
                    else
                    {
                        <!-- Tlačítko pro editaci existujícího hlasování -->
                        <button type="button" class="btn btn-outline-primary" id="edit-voting-btn" data-bs-toggle="modal" data-bs-target="#voting-modal">
                            <i class="bi bi-pencil"></i> Upravit hlasování
                        </button>
                    }
                </div>

                <!-- Modal pro správu hlasování -->
                <div class="modal fade" id="voting-modal" tabindex="-1" aria-labelledby="voting-modal-label" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="voting-modal-label">
                                    @(Model.Discussion.VoteType == VoteType.None ? "Vytvořit hlasování" : "Upravit hlasování")
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zavřít"></button>
                            </div>
                            <div class="modal-body">
                                <!-- Přepínač stavu hlasování -->
                                    <div class="mb-3">
                                        <label class="form-label">Stav hlasování</label>
                                        <select class="form-select" id="voting-type-modal" name="VoteType">
                                            <option value="1" selected="@(Model.Discussion.VoteType == VoteType.Visible)">Viditelné a aktivní</option>
                                            <option value="2" selected="@(Model.Discussion.VoteType == VoteType.Closed)">Uzavřené (pouze zobrazení výsledků)</option>
                                            <option value="3" selected="@(Model.Discussion.VoteType == VoteType.Hidden)">Skryté (viditelné pouze pro autora a adminy)</option>
                                        </select>
                                        <div class="form-text">Určuje, zda a jak bude hlasování zobrazeno uživatelům.</div>
                                    </div>

                                <!-- Kontejner pro správu otázek (zobrazen pouze pokud je vybráno jiné než "Žádné hlasování") -->
                                <div id="voting-questions-modal-container">
                                    <!-- Tlačítko pro přidání nové otázky -->
                                    <div class="mb-3">
                                        <button type="button" class="btn btn-sm btn-success" id="add-question-btn-modal">
                                            <i class="bi bi-plus-circle"></i> Přidat novou otázku
                                        </button>
                                    </div>

                                    <!-- Seznam otázek hlasování -->
                                    <div id="voting-questions-modal-list">
                                        <!-- Sem se dynamicky přidají otázky -->
                                        <div class="text-muted text-center py-3" id="no-questions-message-modal">
                                            Zatím nejsou přidány žádné otázky.
                                        </div>
                                    </div>

                                    <!-- Šablona pro novou otázku (skrytá) -->
                                    <template id="question-template-modal">
                                        <div class="voting-question-modal card mb-3">
                                            <div class="card-header d-flex justify-content-between align-items-center">
                                                <span class="question-number-modal">Otázka #</span>
                                                <div>
                                                    <button type="button" class="btn btn-sm btn-outline-danger remove-question-btn-modal">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label class="form-label">Text otázky</label>
                                                    <textarea class="form-control question-text-modal" rows="2" maxlength="400" required></textarea>
                                                    <div class="form-text text-end">
                                                        <span class="char-count-modal">0</span>/400 znaků
                                                    </div>
                                                </div>
                                                <div class="mb-2">
                                                    <label class="form-label">Pořadí zobrazení</label>
                                                    <input type="number" class="form-control question-order-modal" min="1" value="1" required>
                                                </div>
                                                <!-- Skrytý input pro ID otázky (při editaci) -->
                                                <input type="hidden" class="question-id-modal" value="">
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zrušit</button>
                                <button type="button" class="btn btn-primary" id="save-voting-btn">Uložit</button>
                            </div>
                        </div>
                    </div>
                </div>
            }

                @* Sekce komentářů *@
                <div class="mt-5">
                    <h3>Komentáře</h3>

                    @* Formulář pro přidání nového komentáře *@
                    @if (Model.IsUserLoggedIn)
                    {
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5>Přidat komentář</h5>
                                <form method="post" asp-page-handler="AddComment">
                                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                    <textarea asp-for="NewComment.Content" id="new-comment-textarea" class="form-control" rows="3"
                                              placeholder="Napište komentář..." required></textarea>
                                    <div class="btn-add-coment-wrapper">
                                        <button type="submit" id="submit-comment-button" class="btn btn-primary mt-2">Odeslat</button>
                                        <button type="button" id="emoji-btn" class="mt-2">&#128512;</button>
                                    </div>

                                    <div id="emoji-list">
                                        <!-- Srdce a like emoji -->
                                        <span class="emoji">&#x2764;&#xFE0F;</span>     <!-- červené srdce -->
                                        <span class="emoji">&#128077;</span>    <!-- palec nahoru -->
                                        <span class="emoji">&#128079;</span>    <!-- tleskání -->
                                        <span class="emoji">&#128076;</span>    <!-- OK symbol -->
                                        <span class="emoji">&#128591;</span>    <!-- sepjaté ruce -->
                                        <span class="emoji">&#128075;</span>    <!-- mávající ruka -->
                                        <span class="emoji">&#128170;</span>    <!-- biceps -->
                                        <span class="emoji">&#128400;</span>    <!-- OK symbol ruka -->
                                        <!-- Standardní smajlíky vyjadřující emoce -->
                                        <span class="emoji">&#128512;</span>    <!-- široký úsměv -->
                                        <span class="emoji">&#128513;</span>    <!-- úsměv s velkýma očima -->
                                        <span class="emoji">&#128514;</span>    <!-- smích se slzami -->
                                        <span class="emoji">&#128515;</span>    <!-- úsměv s úsměvnýma očima -->
                                        <span class="emoji">&#128516;</span>    <!-- úsměv s přimhouřenýma očima -->
                                        <span class="emoji">&#128517;</span>    <!-- úsměv s potem -->
                                        <span class="emoji">&#128518;</span>    <!-- úsměv s šilhavýma očima -->
                                        <span class="emoji">&#128519;</span>    <!-- anděl -->
                                        <span class="emoji">&#128520;</span>    <!-- ďáblík -->
                                        <span class="emoji">&#128521;</span>    <!-- mrkající -->
                                        <span class="emoji">&#128522;</span>    <!-- spokojený -->
                                        <span class="emoji">&#128523;</span>    <!-- olizující se -->
                                        <span class="emoji">&#128524;</span>    <!-- bez výrazu -->
                                        <span class="emoji">&#128525;</span>    <!-- zamilovaný -->
                                        <span class="emoji">&#128526;</span>    <!-- chladný s brýlemi -->
                                        <span class="emoji">&#128527;</span>    <!-- samolibý -->
                                        <span class="emoji">&#128528;</span>    <!-- neutrální -->
                                        <span class="emoji">&#128529;</span>    <!-- bezvýrazný -->
                                        <span class="emoji">&#128530;</span>    <!-- zklamaný -->
                                        <span class="emoji">&#128531;</span>    <!-- studený pot -->
                                        <span class="emoji">&#128532;</span>    <!-- smutný -->
                                        <span class="emoji">&#128533;</span>    <!-- zmatený -->
                                        <span class="emoji">&#128534;</span>    <!-- sklíčený -->
                                        <span class="emoji">&#128535;</span>    <!-- polibek -->
                                        <span class="emoji">&#128536;</span>    <!-- polibek s očima -->
                                        <span class="emoji">&#128537;</span>    <!-- milující -->
                                        <span class="emoji">&#128538;</span>    <!-- polibek s úsměvem -->
                                        <span class="emoji">&#128539;</span>    <!-- vypláznutý jazyk -->
                                        <span class="emoji">&#128540;</span>    <!-- vypláznutý jazyk a mrkání -->
                                        <span class="emoji">&#128541;</span>    <!-- vypláznutý jazyk a šilhání -->
                                        <span class="emoji">&#128542;</span>    <!-- zklamaný -->
                                        <span class="emoji">&#128543;</span>    <!-- uražený -->
                                        <span class="emoji">&#128544;</span>    <!-- vzteklý -->
                                        <span class="emoji">&#128545;</span>    <!-- rozzlobený -->
                                        <span class="emoji">&#128546;</span>    <!-- plačící -->
                                        <span class="emoji">&#128547;</span>    <!-- trpící -->
                                        <span class="emoji">&#128548;</span>    <!-- zamračený se zuby -->
                                        <span class="emoji">&#128549;</span>    <!-- úzkostný s potem -->
                                        <span class="emoji">&#128550;</span>    <!-- překvapený -->
                                        <span class="emoji">&#128551;</span>    <!-- zklamaný ale ulevený -->
                                        <span class="emoji">&#128552;</span>    <!-- vyděšený -->
                                        <span class="emoji">&#128553;</span>    <!-- unavený -->
                                        <span class="emoji">&#128554;</span>    <!-- ospalý -->
                                        <span class="emoji">&#128555;</span>    <!-- unavený -->
                                        <span class="emoji">&#128556;</span>    <!-- grimasa -->
                                        <span class="emoji">&#128557;</span>    <!-- hlasitě plačící -->
                                        <span class="emoji">&#128558;</span>    <!-- překvapený s otevřenými ústy -->
                                        <span class="emoji">&#128559;</span>    <!-- překvapený -->
                                        <span class="emoji">&#128560;</span>    <!-- vyděšený -->
                                        <span class="emoji">&#128561;</span>    <!-- křičící -->
                                        <span class="emoji">&#129326;</span>    <!-- nevolnost -->
                                        <span class="emoji">&#129327;</span>    <!-- kýchnutí -->
                                        <span class="emoji">&#129318;</span>    <!-- obracející oči -->
                                        <span class="emoji">&#129335;</span>    <!-- pokrčení rameny -->
                                        <span class="emoji">&#x1F648;</span>    <!-- opice -->
                                        <span class="emoji">&#128580;</span>    <!-- nedůvěřivý -->
                                        <span class="emoji">&#129296;</span>    <!-- mrzoutský -->
                                        <span class="emoji">&#129301;</span>    <!-- po úrazu -->
                                        <span class="emoji">&#x1F321;</span>    <!-- teploměr -->
                                        <span class="emoji">&#129314;</span>    <!-- na zvracení -->
                                        <span class="emoji">&#128564;</span>    <!-- spící -->
                                        <span class="emoji">&#128567;</span>    <!-- s rouškou -->
                                        <span class="emoji">&#128562;</span>    <!-- šokovaný -->
                                        <!-- Oslavné a sváteční emoji -->
                                        <span class="emoji">&#127881;</span>    <!-- party popper -->
                                        <span class="emoji">&#x2728;</span>    <!-- hvězdicky -->
                                        <span class="emoji">&#128144;</span>    <!-- kvetina -->
                                        <span class="emoji">&#127942;</span>    <!-- trofej -->
                                        <span class="emoji">&#127874;</span>    <!-- narozeninový dort -->
                                        <span class="emoji">&#x1F381;</span>    <!-- dárek -->
                                        <span class="emoji">&#127872;</span>    <!-- dárek -->
                                        <span class="emoji">&#127882;</span>    <!-- konfety -->
                                        <span class="emoji">&#127880;</span>    <!-- hvězda -->
                                        <!-- Jídlo a pití -->
                                        <span class="emoji">&#127849;</span>    <!-- donut -->
                                        <span class="emoji">&#127846;</span>    <!-- zmrzlina -->
                                        <span class="emoji">&#127863;</span>    <!-- víno -->
                                        <span class="emoji">&#127866;</span>    <!-- pivo -->
                                        <span class="emoji">&#129365;</span>    <!-- brambora -->
                                        <span class="emoji">&#129379;</span>    <!-- muffin -->
                                        <span class="emoji">&#127814;</span>    <!-- hruška -->
                                        <span class="emoji">&#129382;</span>    <!-- želé -->
                                        <span class="emoji">&#127812;</span>    <!-- houby -->
                                        <span class="emoji">&#127836;</span>    <!-- nudle -->
                                        <span class="emoji">&#127828;</span>    <!-- hamburger -->
                                        <span class="emoji">&#127839;</span>    <!-- hranolky -->
                                        <span class="emoji">&#127852;</span>    <!-- čokoláda -->
                                        <span class="emoji">&#127829;</span>    <!-- pizza -->
                                        <span class="emoji">&#129366;</span>    <!-- chleba -->
                                        <span class="emoji">&#129472;</span>    <!-- čaj -->
                                        <span class="emoji">&#127851;</span>    <!-- lízátko -->
                                        <span class="emoji">&#129375;</span>    <!-- vajíčko -->
                                        <span class="emoji">&#129360;</span>    <!-- palačinka -->
                                        <span class="emoji">&#129367;</span>    <!-- čajová konvice -->
                                        <span class="emoji">&#127855;</span>    <!-- koktejl -->
                                        <!-- Zvířata -->
                                        <span class="emoji">&#128054;</span>    <!-- pes -->
                                        <span class="emoji">&#128049;</span>    <!-- kočka -->
                                        <span class="emoji">&#128008;</span>    <!-- kočka -->
                                        <span class="emoji">&#128021;</span>    <!-- prasátko -->
                                        <span class="emoji">&#128039;</span>    <!-- kuře -->
                                        <span class="emoji">&#128038;</span>    <!-- pták -->
                                        <span class="emoji">&#128044;</span>    <!-- kuře -->
                                        <span class="emoji">&#128023;</span>    <!-- ovce -->
                                        <span class="emoji">&#128040;</span>    <!-- koala -->
                                        <span class="emoji">&#129409;</span>    <!-- lama -->
                                        <span class="emoji">&#129418;</span>    <!-- liška -->
                                        <!-- Květiny a příroda -->
                                        <span class="emoji">&#127808;</span>    <!-- čtyřlístek -->
                                        <span class="emoji">&#x1F335;</span>    <!-- kaktus -->
                                        <span class="emoji">&#x1F334;</span>    <!-- palma -->
                                        <span class="emoji">&#127794;</span>    <!-- jehličnatý strom -->
                                        <span class="emoji">&#127793;</span>    <!-- listnatý strom -->
                                        <span class="emoji">&#127807;</span>    <!-- tulipán -->
                                        <span class="emoji">&#127799;</span>    <!-- růže -->
                                        <span class="emoji">&#127804;</span>    <!-- slunečnice -->
                                        <span class="emoji">&#127802;</span>    <!-- zvadlá květina -->
                                        <span class="emoji">&#127809;</span>    <!-- javor -->
                                        <span class="emoji">&#127810;</span>    <!-- listí -->
                                        <!-- Počasí a vesmír -->
                                        <span class="emoji">&#9728;</span>      <!-- slunce -->
                                        <span class="emoji">&#11088;</span>     <!-- hvězda -->
                                        <span class="emoji">&#127771;</span>    <!-- měsíc -->
                                        <span class="emoji">&#9889;</span>      <!-- blesk -->
                                        <span class="emoji">&#9729;</span>      <!-- mrak -->
                                        <span class="emoji">&#127785;</span>    <!-- tornádo -->
                                        <span class="emoji">&#127782;</span>    <!-- duha -->
                                        <span class="emoji">&#10052;</span>     <!-- sněhová vločka -->
                                        <span class="emoji">&#x2603;</span>     <!-- sněhulák -->
                                        <span class="emoji">&#9748;</span>      <!-- deštník -->
                                        <!-- Doprava a budovy -->
                                        <span class="emoji">&#128663;</span>    <!-- auto -->
                                        <span class="emoji">&#9992;</span>      <!-- letadlo -->
                                        <span class="emoji">&#x1F3D6;</span>      <!-- letadlo -->
                                        <span class="emoji">&#128674;</span>    <!-- loď -->
                                        <span class="emoji">&#128690;</span>    <!-- kolo -->
                                        <span class="emoji">&#128657;</span>    <!-- ambulance -->
                                        <span class="emoji">&#x1F514;</span>    <!-- zvonek -->
                                        <span class="emoji">&#9888;</span>      <!-- varování -->
                                        <span class="emoji">&#128680;</span>    <!-- policie -->
                                        <span class="emoji">&#128643;</span>    <!-- metro -->
                                        <span class="emoji">&#128642;</span>    <!-- lokomotiva -->
                                        <span class="emoji">&#127974;</span>    <!-- budova -->
                                        <span class="emoji">&#127968;</span>    <!-- dům -->
                                        <span class="emoji">&#127981;</span>    <!-- továrna -->
                                        <span class="emoji">&#127970;</span>    <!-- vysoká budova -->
                                        <!-- Různé -->
                                        <span class="emoji">&#128176;</span>    <!-- peníze s křídly -->
                                        <span class="emoji">&#128181;</span>    <!-- měna -->
                                        <span class="emoji">&#x1F4D6;</span>    <!-- kniha -->
                                        <span class="emoji">&#x1F4DA;</span>    <!-- knihy -->
                                        <span class="emoji">&#128197;</span>    <!-- kalendář -->
                                        <span class="emoji">&#9989;</span>      <!-- zelená značka zaškrtnutí -->
                                        <span class="emoji">&#10060;</span>     <!-- červený křížek -->
                                        <span class="emoji">&#128066;</span>    <!-- ucho -->
                                        <span class="emoji">&#128064;</span>    <!-- oči -->
                                        <span class="emoji">&#128067;</span>    <!-- nos -->
                                        <span class="emoji">&#127936;</span>    <!-- basketbal -->
                                        <span class="emoji">&#127938;</span>    <!-- lyžař -->
                                        <span class="emoji">&#9917;</span>      <!-- fotbalový míč -->
                                        <span class="emoji">&#x1F945;</span>    <!-- brána -->
                                        <span class="emoji">&#127939;</span>    <!-- běžec -->
                                        <span class="emoji">&#128240;</span>    <!-- noviny -->
                                        <span class="emoji">&#128241;</span>    <!-- telefon -->
                                        <span class="emoji">&#x1F4FA;</span>    <!-- tv -->
                                        <span class="emoji">&#128269;</span>    <!-- lupa -->
                                        <span class="emoji">&#128373;</span>    <!-- detektiv -->
                                    </div>
                                </form>
                            </div>
                        </div>
                    }

                    @* Sekce seznamu komentářů *@
                    <div id="comments-container">
                        @if (Model.Discussion.Comments.Any())
                        {
                            @* Hlavní kontejner pro seznam komentářů - do něj se budou přidávat další komentáře pomocí JavaScriptu *@
                            <div id="comments-list">
                                @* Iterace přes root komentáře *@
                                @foreach (var comment in Model.Discussion.Comments)
                                {
                                    @* Vypsání jednoho root komentáře s případnými reakčními komentáři a všemi tlačítky *@
                                    @await Html.PartialAsync("_CommentPartial", comment);
                                }
                            </div>

                            @* Tlačítko pro načtení dalších komentářů *@
                            @if (Model.Discussion.HasMoreComments)
                            {
                                <div id="loading-container" class="text-center mb-4">
                                    <button id="load-more-comments" class="btn btn-primary" onclick="loadMoreComments(@Model.Discussion.Id)">
                                        Načíst další komentáře
                                    </button>
                                    <div id="loading-spinner" class="d-none">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Načítání...</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <p>Zatím žádné komentáře.</p>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@* Skrytý input pro API URL *@
<input type="hidden" id="apiBaseUrl" value="@Model.PublicApiBaseUrl" />
<input type="hidden" id="current-page" value="@Model.CurrentPage" />
<input type="hidden" id="is-user-logged-in" value="@Model.IsUserLoggedIn.ToString().ToLower()" />

@section Scripts {
    <!-- Import CKEditoru s podporou nahrávání obrázků -->
    <script src="https://cdn.ckeditor.com/ckeditor5/40.0.0/classic/ckeditor.js"></script>

    <!-- Přidáme plugin pro nahrávání souborů -->
    <script src="https://cdn.ckeditor.com/ckeditor5/40.0.0/classic/translations/cs.js"></script>

    <!-- Import adaptéru pro nahrávání souborů -->
    <script src="~/js/ckeditor-upload-adapter.js"></script>

    <!-- Pro přihlášeného uživatele uloží jeho JWT (JSON Web Token) do sessionStorage prohlížeče -->
    @if (Model.IsUserLoggedIn)
    {
        <script>
            sessionStorage.setItem('JWTToken', '@Model.JwtToken');
        </script>
    }
    <div id="discussion-settings" data-can-upload="@Model.CanUploadFiles.ToString().ToLower()"></div>
    <script>
        // Nastavení proměnné s informací, zda uživatel může nahrávat soubory
        const canUploadFiles = document.getElementById("discussion-settings").dataset.canUpload === "true";
    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Import javascriptu -->
    <script src="~/js/discussion.js" asp-append-version="true"></script>
    <script>window.discussionId = @(ViewData["DiscussionId"] ?? 0);</script>
    <script src="~/js/voting.js" asp-append-version="true"></script>
}