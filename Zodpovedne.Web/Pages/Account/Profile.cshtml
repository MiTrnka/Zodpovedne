@page "/Account/Profile/{nickname}"
@model ProfileModel
@{
    ViewData["Title"] = "Profil";

    //Pokud je jakýkoliv text v ErrorMessage, tak se zobrazí a zbytek stránky se nevykreslí
    if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-warning">
            <h4>@Model.ErrorMessage</h4>
        </div>
        return;
    }
    //Pokud je jakýkoliv text v StatusMessage, tak se zobrazí úplně nahoře a pokračuje se ve vykreslování stránky
    if (!string.IsNullOrEmpty(Model.StatusMessage))
    {
        <div class="alert alert-info">
            <h4>@Model.StatusMessage</h4>
        </div>
    }
}

<div class="container">
    <div class="col-md-6">
        <h2>Profil uživatele</h2>

        <div class="card mb-4">
            <div class="card-body">
                <dl>
                    <dt>Přezdívka</dt>
                    <dd>@Model.UserProfile?.Nickname</dd>
                    <dt>Registrován</dt>
                    <dd>@Model.UserProfile?.Created.ToString("dd.MM.yyyy HH:mm")</dd>
                    @if (@Model.UserProfile?.LastLogin != null)
                    {
                        <dt>Poslední přihlášení</dt>
                        <dd>@Model.UserProfile?.LastLogin?.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</dd>
                    }
                </dl>
            </div>
        </div>

        <!-- Tlačítko s žádostí o přátelství -->
        @if (Model.IsUserLoggedIn && Model.UserProfile?.Id != Model.CurrentUserId)
        {
            <hr />
            <div class="mt-3">
                @if (Model.CanRequestFriendship)
                {
                    <!-- Uživatel může odeslat novou žádost o přátelství -->
                    <form method="post" asp-page-handler="RequestFriendship" asp-route-targetUserId="@Model.UserProfile?.Id" asp-route-nickname="@Model.UserProfile?.Nickname">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-person-plus"></i> Požádat o přátelství
                        </button>
                    </form>
                }
                else if (Model.HasPendingFriendshipRequest)
                {
                    <!-- Žádost již byla odeslána, ale čeká na schválení -->
                    <button class="btn btn-secondary" disabled>
                        <i class="bi bi-hourglass-split"></i> Žádost odeslána
                    </button>
                }
                <!-- Pro stavy Approved (přijato) a Denied (odmítnuto) se nic nezobrazuje -->
            </div>
        }
        <!-- Sekce s diskuzemi uživatele -->
        <h3>Diskuze vytvořené uživatelem @Model.UserProfile?.Nickname</h3>
        <div class="card-body">
            @if (Model.UserDiscussions.Any())
            {
                <div class="list-group">
                    @foreach (var discussion in Model.UserDiscussions)
                    {
                        <a href="/categories/@discussion.CategoryCode/@discussion.DiscussionCode" class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">@discussion.Title</h5>
                                <small>@discussion.UpdatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</small>
                            </div>
                            <p class="mb-1">Kategorie: @discussion.CategoryName</p>
                            <small>
                                <i class="bi bi-eye"></i> @discussion.ViewCount zobrazení
                                <span class="mx-2">•</span>
                                <i class="bi bi-calendar"></i> Vytvořeno: @discussion.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")
                            </small>
                        </a>
                    }
                </div>
            }
            else
            {
                <p class="text-muted">Uživatel zatím nevytvořil žádné diskuze.</p>
            }
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script>

    </script>
}