@* Category.cshtml *@
@page "/categories/{categoryCode}"
@model CategoryModel
@{
    ViewData["Title"] = Model.CategoryName;

    //Pokud je jakýkoliv text v ErrorMessage, tak se zobrazí a zbytek stránky se nevykreslí
    if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-warning">
            <h4>@Model.ErrorMessage</h4>
        </div>
        return;
    }
    //Pokud je jakýkoliv text v StatusMessage, tak se zobrazí úplně nahoře a pokračuje se ve vykreslování stránky
    if (!string.IsNullOrEmpty(Model.StatusMessage))
    {
        <div class="alert alert-info">
            <h4>@Model.StatusMessage</h4>
        </div>
    }
}

<div class="container">
    <div class="row mb-4">
        <div class="col">
            <h1>@Model.CategoryName</h1>
            @if (!string.IsNullOrEmpty(Model.CategoryDescription))
            {
                <p class="lead">@Model.CategoryDescription</p>
            }
        </div>
    </div>

    @if (Model.Discussions.Any())
    {
        <div class="row">
            @foreach (var discussion in Model.Discussions.OrderByDescending(d => d.Type == Zodpovedne.Contracts.Enums.DiscussionType.Top).ThenByDescending(d => d.CreatedAt))
            {
                <div class="col-12 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">
                                @if (discussion.Type == Zodpovedne.Contracts.Enums.DiscussionType.Top)
                                {
                                    <span class="badge bg-primary me-2">TOP</span>
                                }
                                <a href="/categories/@Model.CategoryCode/@discussion.Code" class="text-decoration-none">@discussion.Title</a>
                            </h5>
                            <div class="card-text small text-muted">
                                <span title="Autor">
                                    <i class="bi bi-person"></i> @discussion.AuthorNickname
                                </span>
                                <span class="mx-2">•</span>
                                <span title="Datum vytvoření">
                                    <i class="bi bi-calendar"></i> @discussion.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")
                                </span>
                                <span class="mx-2">•</span>
                                <span title="Počet komentářů">
                                    <i class="bi bi-chat"></i> @discussion.CommentsCount
                                </span>
                                <span class="mx-2">•</span>
                                <span title="Počet zobrazení">
                                    <i class="bi bi-eye"></i> @discussion.ViewCount
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="row">
            <div class="col">
                <div class="alert alert-info">
                    V této kategorii zatím nejsou žádné diskuze.
                </div>
            </div>
        </div>
    }

    @if (HttpContext.Session.GetString("JWTToken") != null)
    {
        <div class="row mt-4">
            <div class="col">
                <a href="/discussion/create/@Model.CategoryCode" class="btn btn-primary">
                    <i class="bi bi-plus-circle"></i> Nová diskuze
                </a>
            </div>
        </div>
    }
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
}